<v:bread>
    <v:bread_item string="Goods Transfer" action="pick_internal_all"/>
    {{#ifeq context.data.state "draft"}}
        <v:bread_item string="Draft" action="pick_internal_draft"/>
    {{/ifeq}}
    {{#ifeq context.data.state "pending"}}
        <v:bread_item string="Pending" action="pick_internal_pending"/>
    {{/ifeq}}
    {{#ifeq context.data.state "done"}}
        <v:bread_item string="Completed" action="pick_internal_done"/>
    {{/ifeq}}
</v:bread>
<v:page title="{{#if context.data.id}}Edit{{else}}New{{/if}} Goods Transfer">
    <v:flash/>
    <v:form border="1"{{#ifin context.data.state "done" "voided"}} readonly="1"{{/ifin}}>
        <v:form_head>
            <strong>{{field_value "state" context=context}}</strong>
            {{#if context.data.id}}
                <div class="btn-toolbar" style="float:right;margin:0">
                    <v:button string="Print PDF" icon="print" action="report_pick_form_doc" action_options="picking_id={{context.data.id}}"/>
                    <v:button_group string="Options" dropdown="1" align="right">
                        <v:item string="Copy" method="copy"/>
                        {{#ifeq context.data.state "done"}}
                            <v:divider/>
                            <v:item string="Void" method="void" confirm="Are you sure you want to void this goods transfer?"/>
                        {{/ifeq}}
                    </v:button_group>
                </div>
            {{/if}}
        </v:form_head>
        <v:form_body {{#unless context.readonly}}background="1"{{/unless}}>
            <v:row>
                <v:field name="number" span="2"/>
                <v:field name="ref" span="2"/>
                <v:field name="date" span="2"/>
            </v:row>
            <v:field name="lines" template="pick_internal_line_sheet" count="5" nolabel="1"/>
            <v:field name="state" invisible="1"/>
            <v:field name="uuid" invisible="1"/>
            <v:field name="type" invisible="1"/>
        </v:form_body>
        {{#ifin context.data.state "draft" "pending"}}
            <v:form_foot>
                <v:button_group string="Save" split="1" method="_save" size="large" type="primary" next="pick_internal_all">
                    <v:item string="Save &amp; set to pending" method="pending" next="pick_internal_pending"/>
                </v:button_group>
                {{#ifeq context.data.state "pending"}}
                    <v:button string="Validate" action="pick_validate" action_options="picking_id={{context.data.id}}" size="large"/>
                {{/ifeq}}
            </v:form_foot>
        {{/ifin}}
    </v:form>
    <v:history uuid="{{context.data.uuid}}"/>
</v:page>
